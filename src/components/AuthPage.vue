<template lang="">
    <main :class='animClass'>
        <div class="main-block">
            <div class="main-block__head">
                <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å  üëã</h1>
                <h2>
                    –°–µ–≥–æ–¥–Ω—è –Ω–æ–≤—ã–π –¥–µ–Ω—å. –≠—Ç–æ —Ç–≤–æ–π –¥–µ–Ω—å. 
                    –¢—ã –µ–≥–æ —Ñ–æ—Ä–º–∏—Ä—É–µ—à—å. –í–æ–π–¥–∏, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å 
                    —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏.
                </h2>
                <form v-if='isSignIn' class="main-block__auth-form" @submit.prevent = "">
                    <div class="auth-form__login">
                        <label for="email">–ü–æ—á—Ç–∞
                            <span class='label-error' v-if='logLoginErrorVisible'>{{loginError}}</span>

                        </label>
                        <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            placeholder="Example@email.com" 
                            required
                            v-model = "getLogin"
                            >
                    </div>
                    <div class="auth-form__password">
                        <label for="password">–ü–∞—Ä–æ–ª—å
                            <span class='label-error' v-if='logPasswordErrorVisible'>{{passwordError}}</span>
                        </label>
                        <input 
                            type="password" 
                            id="password" 
                            name="password" 
                            minlength="5" 
                            placeholder="–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 5 —Å–∏–º–≤–æ–ª–æ–≤" 
                            required
                            v-model = "getPassword"
                            >
                    </div>
                    <span class="auth-error" v-if="authErrorLogVisible">{{authErrorTextLog}}</span>
                    <button @click = "signIn" type="submit" class="login-button" to='/'>–í–æ–π—Ç–∏</button>
                </form>

                <form v-if='isSignUp' class="main-block__auth-form" @submit.prevent = "">
                    <div class="auth-form__login">
                        <label for="name">–í–∞—à–µ –∏–º—è
                            <span class='label-error' v-if='regNameErrorVisible'>{{regNameError}}</span>
                        </label>
                        <input 
                            type="name" 
                            id="name" 
                            name="name" 
                            placeholder="–ò–º—è" 
                            required
                            v-model = "getNewName"
                            >
                    </div>
                    <div class="auth-form__login">
                        <label for="email">–ü–æ—á—Ç–∞
                            <span class='label-error' v-if='regLoginErrorVisible'>{{loginError}}</span>
                        </label>
                        <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            placeholder="Example@email.com" 
                            required
                            v-model = "getNewLogin"
                            >
                    </div>
                    <div class="auth-form__password">
                        <label for="password">–ü–∞—Ä–æ–ª—å
                            <span class='label-error' v-if='regPasswordErrorVisible'>{{passwordError}}</span>
                        </label>
                        <input 
                            type="password" 
                            id="password" 
                            name="password" 
                            minlength="5" 
                            placeholder="–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 5 —Å–∏–º–≤–æ–ª–æ–≤" 
                            required
                            v-model = "getNewPassword"
                            >
                    </div>
                    <div class="auth-form__password">
                        <label for="confirm-password">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å
                            <span class='label-error' v-if='regConfirmPasswordErrorVisible'>{{regConfirmPasswordError}}</span>
                        </label>
                        <input 
                            type="password" 
                            id="confirm-password" 
                            name="confirm-password" 
                            minlength="5" 
                            placeholder="–ü–∞—Ä–æ–ª–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å" 
                            required
                            v-model = "getConfirmPassword"
                            >
                    </div>
                    <span class="auth-error" v-if="authErrorRegVisible">{{authErrorTextReg}}</span>
                    <button @click = "signUp" type="submit" class="login-button">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                </form>

                <div class="auth-form__sign-up">
                    <span v-if='isSignIn'>–£ –º–µ–Ω—è –Ω–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞!</span>
                    <span v-if='isSignUp'>–£ –º–µ–Ω—è —É–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç!</span>
                
                    <a @click = "showSignUp" v-if='isSignIn'>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                    <a @click = "showSignIn" v-if='isSignUp'>–í–æ–π—Ç–∏</a>
                </div>
            </div>
            <div class="main-block__img">
                <img class="login-img" src="@/assets/IMGs/Login Art.png" alt="Login Art">
            </div>
        </div>
    </main>
</template>
<script>
import { mapActions, mapGetters} from 'vuex';
export default {
    name: 'AuthPage',
    data(){
        return{
            getLogin: '',
            getPassword: '',

            getNewName: '',
            getNewLogin: '',
            getNewPassword: '',
            getConfirmPassword: '',

            isSignUp: false,
            isSignIn: true,

            authErrorTextLog: '',
            authErrorTextReg: '',

            authErrorLogVisible: false,
            authErrorRegVisible: false,


            loginError: '–ü–æ—á—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ—á—Ç–æ–π',
            passwordError: '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ –º–µ–Ω–µ–µ 5 —Å–∏–º–≤–æ–ª–æ–≤',

            regNameError: '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∫ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—é',
            regConfirmPasswordError: '–ü–∞—Ä–æ–ª–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å',

            regNameErrorVisible: false,
            regLoginErrorVisible: false,
            regPasswordErrorVisible: false,
            regConfirmPasswordErrorVisible: false,

            logLoginErrorVisible: false,
            logPasswordErrorVisible: false,

            validateEmail: /^[^\s@]+@[^\s@]+\.[^\s@]+$/,
            
        }
    },
    watch:{
        authErrorRegFromServer(newValue){
            if(newValue !== ''){
                this.authErrorTextReg = newValue;
                this.authErrorRegVisible = true;
            }
        },
        authErrorLogFromServer(newValue){
            if(newValue !== ''){
                this.authErrorTextLog = newValue;
                this.authErrorLogVisible = true;
            }
        },
    },
    computed:{
        ...mapGetters({
            authErrorLogFromServer: 'authModule/authErrorLog',
            authErrorRegFromServer: 'authModule/authErrorReg',
            animClass: 'animationModule/authAnim',
        })
    },
    methods:{
        ...mapActions({
            axiosLogin: 'authModule/axiosLogin',
            axiosReg: 'authModule/axiosReg',
            changeAnimClass: 'animationModule/changeVarAnim'
        }),
        showSignIn(){
            this.isSignUp = false;
            this.isSignIn = true;
        },
        showSignUp(){
            this.isSignIn = false;
            this.isSignUp = true;
        },

        signIn(){
            if(this.validateEmail.test(this.getLogin) && this.getPassword.length > 4){
                this.axiosLogin({userLogin: this.getLogin, userPassword: this.getPassword});
            }
            if(this.getPassword.length < 5){
                this.logPasswordErrorVisible = true;
            }
            if(!this.validateEmail.test(this.getLogin)){
                this.logLoginErrorVisible = true;
            }
        },
        signUp(){
            if(this.getNewPassword === this.getConfirmPassword && this.getNewName && this.validateEmail.test(this.getNewLogin) && this.getNewPassword.length > 4){
                this.axiosReg({newName: this.getNewName, newLogin: this.getNewLogin, newPassword: this.getNewPassword});
            }
            if(!this.getNewName){
                this.regNameErrorVisible = true;
            }
            if(!this.validateEmail.test(this.getNewLogin)){
                this.regLoginErrorVisible = true;
            }
            if(this.getNewPassword.length < 5){
                this.regPasswordErrorVisible = true;
            }
            if(this.getNewPassword !== this.getConfirmPassword){
                this.regConfirmPasswordErrorVisible = true;
            }
            
        }
    }

}
</script>
<style scoped>
@import url('https://fonts.googleapis.com/css2?family=Montserrat+Alternates:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Montserrat+Alternates:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap');

@keyframes kanbanAnim{
    0%{
        transform: scale(90%);
        filter: blur(3px);
        opacity: 0;
    }
}

.hide-auth{
    transform: scale(50%);
    opacity: 0;
    filter: blur(10px);
}

.label-error{
    color: red;
}

html{
    height: 100%;
    display: none;
}

body{
    display: flex;
    height: 100%;
    align-items: center;
}

main{
    animation: kanbanAnim .5s;
    transition: .2s;
    width: 86%;
    margin: 0 auto;
    display: flex;
    align-items: center;
}

button{
    background-color: var(--button-bg) !important;
    color: white;
    border: none;
    padding: 10px;
    border-radius: 12px !important;
    cursor: pointer;
    transition: .3s;
}

button:hover{
    transform: scale(95%);
}
button:active{
    transform: scale(90%);
}

.login-button{
    font-family: 'Roboto', sans-serif;
    font-weight: 400;
}

h1{
    font-family: "Montserrat Alternates", sans-serif;
    font-weight: 600;
    color: var(--head-text);
    font-size: 34px;
}

h2{
    font-family: "Montserrat Alternates", sans-serif;
    font-weight: 500;
    color: var(--head-text);
    font-size: 18px;
    width: 70%;
}


p, label, span{
    color: var(--main-text);
    font-size: 14px;
    font-family: 'Roboto', sans-serif;
    font-weight: 400;
}

label{
    margin-bottom: 4px;
}

input{
    padding: 10px;
    border: 1px solid rgba(212, 215, 227, 1);
    background-color: var(--input-bg);
    border-radius: 12px;
    box-sizing: border-box;
    transition: .2s;
}

input:focus{
    outline: none;
}

input::placeholder{
    font-size: 14px;
    font-family: 'Roboto', sans-serif;
    font-weight: 400;
}

a{
    text-decoration: none;
    color: var(--link);
    font-size: 14px;
    font-family: 'Roboto', sans-serif;
    font-weight: 400;
    cursor: pointer;
}

.main-block{
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.login-img{
    display: block;
    width: 100%;
}

.main-block__head{
    display: flex;
    flex-direction: column;
}

.main-block__auth-form{
    width:70%;
}

.main-block__auth-form{
    display: flex;
    flex-direction: column;
    margin-top: 20px;
    gap: 20px;
}

.auth-form__login, .auth-form__password{
    font-family: 'Roboto', sans-serif;
    display: flex;
    flex-direction: column;
}

.auth-form__forgot-password{
    text-align: right;
}

.auth-form__sign-up{
    display: flex;
    gap: 6px;
    justify-content: center;
    align-items: center;
    width: 60%;
    margin-top: 10px;
}

.auth-error{
    color: red;
    margin: 0 auto;
}


    
</style>